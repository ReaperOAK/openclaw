# docker-compose.production.yml
# Deployed to: /opt/openclaw/shared/docker-compose.production.yml
# Also copied into each release directory by deploy.sh
services:
  openclaw-gateway:
    image: openclaw:local
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    environment:
      NODE_ENV: production
      HOME: /home/node
      TERM: xterm-256color
    volumes:
      - /opt/openclaw/shared/openclaw-data:/home/node/.openclaw
      - /opt/openclaw/shared/workspace:/home/node/.openclaw/workspace
    ports:
      - "127.0.0.1:18789:18789"
      - "127.0.0.1:18790:18790"
    init: true
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: "2.0"
        reservations:
          memory: 512M
    healthcheck:
      test: [ "CMD", "node", "-e", "fetch('http://localhost:18789/').then(r => process.exit(r.ok ? 0 : 1)).catch(() => process.exit(1))" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    command: [ "node", "dist/index.js", "gateway", "--bind", "lan", "--port", "18789" ]
